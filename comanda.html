<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Comanda 58mm</title>
  <style>
    @page {
      size: 58mm auto;
      margin: 2mm;
    }
    body {
      font-family: Tahoma, Helvetica, sans-serif;
      margin: 0;
      font-size: 4mm;
      text-align: center;
    }
    .ticket {
      width: 100%;
      box-sizing: border-box;
    }
    h1 {
      font-size: 6mm;
      margin: 1mm 0;
      font-weight: bold;
    }
    .ticket-num, .mesa {
      font-size: 4mm;
      font-weight: bold;
      margin: 1mm 0;
    }
    .fecha {
      font-size: 4mm;
      margin: 1mm 0;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1mm;
    }
    th, td {
      font-size: 4mm;   /* 游댳 Reducido */
      padding: 0.5mm 1mm;
      text-align: left;
      word-wrap: break-word;
    }
    th {
      border-bottom: 1px dashed black;
      text-align: center;
      font-weight: bold;
    }
    td.right {
      text-align: right;
    }
    .comentario {
      font-size: 3.2mm; /* 游댳 M치s peque침o */
      font-style: italic;
      margin-left: 1mm;
    }
    .total {
      font-size: 4mm;   /* 游댳 Reducido */
      font-weight: bold;
      margin-top: 1mm;
      text-align: right;
      border-top: 1px dashed black; /* 游댳 L칤nea encima del TOTAL */
      padding-top: 1mm;
    }
  </style>
</head>
<body onload="window.print()" onfocus="window.close()">
  <div class="ticket">
    <h1>COMANDA</h1>
    <div class="ticket-num" id="nro_boleta_id"></div>
    <div class="mesa" id="nro_mesa_id"></div>
    <div class="fecha" id="fecha_impresion"></div>
    <table>
      <thead>
        <tr><th>Cant</th><th>Descripci칩n</th></tr>
      </thead>
      <tbody id="tablaBody"></tbody>
    </table>
    <div class="total">TOTAL: <span id="total"></span></div>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    function parseList(param) {
      return (param || "").replace(/[{}]/g, "").trim().split(",");
    }
    var nro_boleta = params.get("boleta") || "---";
    var mesa = params.get("mesa") || "---";
    const cantidades = parseList(params.get("cantidades"));
    const servicios = parseList(params.get("servicios"));
    const comentarios = parseList(params.get("comentarios"));
    const precios = parseList(params.get("total"));

    document.getElementById("nro_boleta_id").textContent = nro_boleta;
    document.getElementById("nro_mesa_id").textContent = "PARA: " + mesa;
    const ahora = new Date();
    document.getElementById("fecha_impresion").textContent =
      ahora.toLocaleDateString("es-PE") + " " + ahora.toLocaleTimeString("es-PE");

    let total = 0;
    const tablaBody = document.getElementById("tablaBody");
    servicios.forEach((serv, i) => {
      if (serv.trim() !== "") {
        const cantidad = cantidades[i] || 0;
        total += Number(precios[i] || 0);

        const row = document.createElement("tr");
        row.innerHTML = `<td>${cantidad}</td><td><b>${serv}</b></td>`;
        tablaBody.appendChild(row);

        // Comentario debajo de la descripci칩n
        if (comentarios[i] && comentarios[i].trim() !== "") {
          const commentRow = document.createElement("tr");
          commentRow.innerHTML = `<td></td><td class="comentario">${comentarios[i]}</td>`;
          tablaBody.appendChild(commentRow);
        }
      }
    });

    document.getElementById("total").textContent = total.toFixed(2);
  </script>
</body>
</html>
