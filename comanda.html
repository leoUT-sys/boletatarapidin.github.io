<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Comanda 58mm</title>
  <style>
    @page {
      size: 58mm auto;
      margin: 2mm;
    }
    body {
      font-family: Tahoma, Helvetica, sans-serif;
      margin: 0;
      text-align: center;
      font-size: 4mm;
      color: black;
    }
    .ticket {
      width: 100%;
      box-sizing: border-box;
    }
    h1 {
      font-size: 8mm;
      margin: 2mm 0 1mm 0;
      font-weight: bold;
    }
    .ticket-num {
      font-size: 7mm;
      font-weight: bold;
      margin: 2mm 0;
    }
    .mesa {
      font-size: 7mm;
      font-weight: bold;
      margin: 2mm 0;
    }
    .fecha {
      font-size: 4.5mm;
      margin: 1.5mm 0;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 2mm;
    }
    th, td {
      font-size: 5.5mm;
      padding: 2mm 0;
      text-align: left;
      word-wrap: break-word;
    }
    th {
      border-bottom: 1px dashed black;
      text-align: center;
      font-weight: bold;
    }
    td.right {
      text-align: right;
    }
    .comentario {
      font-size: 4mm;
      font-style: italic;
      margin-bottom: 1mm;
    }
    .total {
      font-size: 5mm;
      font-weight: bold;
      margin-top: 2mm;
      text-align: right;
    }
    .policy {
      margin-top: 3mm;
      font-size: 3.5mm;
      line-height: 1.2;
    }
  </style>
</head>
<body onload="window.print()" onfocus="window.close()">

<div class="ticket">
  <h1>COMANDA</h1>

  <div class="ticket-num" id="nro_boleta_id"></div>
  <div class="mesa" id="nro_mesa_id"></div>
  <div class="fecha" id="fecha_impresion"></div>

  <table>
    <thead>
      <tr>
        <th>Cant</th>
        <th>Descripción</th>
      </tr>
    </thead>
    <tbody id="tablaBody"></tbody>
  </table>

  <div class="total">TOTAL: <span id="total"></span></div>
  <div class="policy">NO TE LO QUEES</div>
</div>

<script>
  const params = new URLSearchParams(window.location.search);

  function parseList(param) {
    let val = (param || "").replace(/[{}]/g, "").trim();
    return val ? val.split(",") : [];
  }

  // Datos
  var nro_boleta = params.get("boleta") || "---";
  var mesa = params.get("mesa") || "---";
  const cantidades = parseList(params.get("cantidades"));
  const servicios = parseList(params.get("servicios"));
  const comentarios = parseList(params.get("comentarios"));
  const precios = parseList(params.get("total")); // precio de cada producto si lo necesitas

  // Número de ticket
  document.getElementById("nro_boleta_id").textContent = nro_boleta;

  // Mesa con "PARA:"
  document.getElementById("nro_mesa_id").textContent = "PARA: " + mesa;

  // Fecha y hora de impresión
  const ahora = new Date();
  document.getElementById("fecha_impresion").textContent =
    ahora.toLocaleDateString("es-PE") + " " + ahora.toLocaleTimeString("es-PE");

  // Renderizar tabla de productos
  let total = 0;
  const tablaBody = document.getElementById("tablaBody");
  servicios.forEach((serv, i) => {
    if (serv.trim() !== "") {
      const cantidad = cantidades[i] || 0;
      total += Number(precios[i] || 0);

      // fila del producto con descripción en negrita
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${cantidad}</td>
        <td><b>${serv}</b></td>
      `;
      tablaBody.appendChild(row);

      // comentario si existe
      if (comentarios[i] && comentarios[i].trim() !== "") {
        const commentRow = document.createElement("tr");
        commentRow.innerHTML = `<td colspan="2" class="comentario">${comentarios[i]}</td>`;
        tablaBody.appendChild(commentRow);
      }
    }
  });

  // Total
  document.getElementById("total").textContent = total.toFixed(2);
</script>

</body>
</html>
