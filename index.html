<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=60mm, initial-scale=1.0"> <!-- ancho ticket 58-60mm -->
    <title>Ticket de Compra</title>
    <style>
      body {
        font-family: tahoma, Helvetica, sans-serif;
        margin: 0;
        font-size: 3mm;
        text-align: center;
      }
      #thermal-pos {
        margin: none;
        max-width: 60mm;
      }
      .table {
        border-collapse: collapse;
        width: 100%;
      }
      .table-header h2, .table-footer h2, .table-footer h4 {
        margin: 0;
        padding: 1mm 0;
      }
      .table-footer td {
        padding: 0;
        line-height: 1;
      }
      .nro_boleta, .nro_mesa, .fecha_recepcion, .info-tienda, .direccion, .m-0 {
        margin: 0;
        padding: 0;
      }
      .logo img {
        width: 120px;
        height: auto;
      }
    </style>
  </head>
  <body onload="window.print()" onfocus="window.close()">

    <script>
      // Obtener parámetros de la URL
      const params = new URLSearchParams(window.location.search);

      var nro_boleta = params.get('boleta') || "---";
      var nro_mesa = params.get('mesa') || "---";
      var direc = params.get('direccion') || "---";

      var fecha = params.get('fecha') || "dd/mm/aaaa hh:mm:ss";
      var fecha_entrega = params.get('fecha_entrega') || "hh:mm:ss";
      var domi = params.get('domi') || "0";
      var propina = params.get('propina') || "0";

      var total = params.get('total') || "0";
      var subtotal_desc = params.get('subtotal_desc') || "0";
      var descuento = params.get('descuento') || "0";
      var estado = params.get('estado') || "--";

      // Datos de productos
      var cantidades = (params.get('cantidades') || "0").split(",");
      var descripciones = (params.get('servicios') || "No hay articulos").split(",");
      var p_units = (params.get('p_unit') || "0").split(",");

      // Limpiar y armar lista
      var result = [];
      cantidades.forEach(function(value, id) {
        let cantidad = parseFloat((cantidades[id] || "0").toString().trim()) || 0;
        let precioUnit = parseFloat((p_units[id] || "0").toString().replace(/[^0-9.]/g, "")) || 0;

        result[id] = {
          cantidad: cantidad,
          descripcion: descripciones[id] || "",
          precio_unit: precioUnit.toLocaleString('es-ES', { minimumFractionDigits: 2 }),
          total_item: (cantidad * precioUnit).toLocaleString('es-ES', { minimumFractionDigits: 2 })
        };
      });
    </script>

    <div id="thermal-pos">
      <div class="label">
        <div class="logo">
          <img src="logo.png" alt="Mi Logo">
        </div>                                 
        <h3>EL RAPIDIN <br>
            Caldos - Chifa - Broaster <br>
            San Martin de Pangoa 
        </h3>
      </div>
      
      <div class="label">
        <b>TICKET:</b>
        <h1 class="nro_boleta" id="nro_boleta_id"></h1>
        <h1 class="nro_mesa" id="nro_mesa_id"></h1>
        <h3 class="direccion" id="nro_direccion_id"></h3>
      </div>

      <div class="label">
        <p class="fecha_recepcion">
          FECHA DE RECEPCION:<br>
          <b id="fechaR"></b> <b id="hora"></b>
        </p>
      </div>
      
      <table class="table">
        <tbody id="tablaBody">
          <tr class="table-header">
            <th><h2>Cant</h2></th>
            <th><h2>Descripción</h2></th>
            <th><h2>Total</h2></th>
          </tr>
          <script>
            var tablaBody = document.getElementById("tablaBody");

            result.forEach(function(row) {
              var newRow = document.createElement("tr");
              newRow.className = "table-item";

              newRow.innerHTML = `
                <td class="item">${row.cantidad}</td>
                <td class="item">${row.descripcion}</td>
                <td class="item">${row.total_item}</td>
              `;
              tablaBody.appendChild(newRow);
            });

            // fila espaciadora
            var spaceRow = document.createElement("tr");
            spaceRow.innerHTML = `<td colspan="3">&nbsp;</td>`;
            tablaBody.appendChild(spaceRow);
          </script>

          <tr class="table-footer">
            <td colspan="2"><h2>EFECTIVO:</h2></td>
            <td><h2 id="efectivo"></h2></td>
          </tr>
          <tr class="table-footer">
            <td colspan="2"><h2>TOTAL:</h2></td>
            <td><h2 id="total"></h2></td>
          </tr>
          <tr class="table-footer">
            <td colspan="2"><h2>DEVUELTO:</h2></td>
            <td><h2 id="devueltas"></h2></td>
          </tr>
        </tbody>
      </table>

      <p class="saldo-text">
        <b><span class="estado-deuda" id="estado"></span></b>
      </p>
      <div class="policy">
        <p><b>IMPORTANTE:</b></p>
        <p class="m-0">
          “Comprobante informativo – sin validez fiscal.”<br/>
          Contacto: 999999999<br/>
          Su preferencia nos motiva a seguir brindando lo mejor. <br> <b>El Rapidín</b>
        </p>
      </div>
    </div>

    <script>
      // Asignar valores
      document.getElementById("nro_boleta_id").textContent = nro_boleta;
      document.getElementById("nro_mesa_id").textContent = nro_mesa;
      document.getElementById("nro_direccion_id").textContent = direc;

      document.getElementById("fechaR").textContent = fecha;
      document.getElementById("hora").textContent = fecha_entrega;

      document.getElementById("total").textContent = total;
      document.getElementById("efectivo").textContent = descuento;
      document.getElementById("devueltas").textContent = subtotal_desc;
      document.getElementById("estado").textContent = estado;
    </script>
  </body>
</html>
