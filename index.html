<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Ticket</title>
<style>
  body {
    font-family: tahoma, Helvetica, sans-serif;
    margin: 0;
    font-size: 3mm;
    text-align: center;
  }
  #ticket {
    max-width: 58mm;
    margin: auto;
  }
  .table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 2mm;
  }
  .table th, .table td {
    text-align: left;
    padding: 1mm;
  }
  .table-header h2, .table td h2 {
    margin: 0;
    font-weight: bold;
  }
  .totales {
    width: 100%;
    font-size: 3mm;
    margin-top: 2mm;
    border-top: 1px dashed black;
  }
  .totales td {
    padding: 0.5mm 0;
  }
  .totales .label {
    text-align: left;
  }
  .totales .valor {
    text-align: right;
  }
  .comentario {
    font-size: 2.5mm;
    font-style: italic;
  }
</style>
</head>
<body onload="window.print()" onfocus="window.close()">

<script>
  const params = new URLSearchParams(window.location.search);

  function parseList(param) {
    let val = (param || "").replace(/[{}]/g, "").trim();
    return val ? val.split(",") : [];
  }

  var nro_boleta = params.get("boleta") || "---";
  var cliente = params.get("cliente") || "---";
  var fecha = params.get("fecha") || "dd/mm/aaaa hh:mm:ss";

  const cantidades = parseList(params.get("cantidades"));
  const productos = parseList(params.get("servicios"));
  const precios = parseList(params.get("precios"));
  const comentarios = parseList(params.get("comentarios"));

  const total_general = params.get("total") || "0";
</script>

<div id="ticket">
  <!-- Título centrado -->
  <h2>TICKET</h2>
  <!-- Número de boleta debajo en negrita -->
  <p><b>N° <span id="nro_boleta_id"></span></b></p>

  <p><b>Cliente:</b> <span id="cliente_id"></span></p>
  <p><b>Fecha:</b> <span id="fechaR"></span></p>

  <table class="table">
    <tbody id="tablaBody">
      <!-- Línea arriba del encabezado -->
      <tr>
        <td colspan="3" style="border-top:1px dashed black;"></td>
      </tr>
      <tr class="table-header">
        <th><h2>Cant</h2></th>
        <th><h2>Descripción</h2></th>
        <th><h2>Precio</h2></th>
      </tr>
      <!-- Línea abajo del encabezado -->
      <tr>
        <td colspan="3" style="border-bottom:1px dashed black;"></td>
      </tr>
    </tbody>
  </table>

  <table class="totales">
    <tbody>
      <tr>
        <td class="label"><h3>TOTAL:</h3></td>
        <td class="valor"><h3 id="total_general"></h3></td>
      </tr>
    </tbody>
  </table>
</div>

<script>
  document.getElementById("nro_boleta_id").textContent = nro_boleta;
  document.getElementById("cliente_id").textContent = cliente;
  document.getElementById("fechaR").textContent = fecha;
  document.getElementById("total_general").textContent = "S/ " + Number(total_general).toFixed(2);

  const tablaBody = document.getElementById("tablaBody");
  productos.forEach((prod, i) => {
    if (prod.trim() !== "") {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td><h2>${cantidades[i] || 0}</h2></td>
        <td>
          <h2>${prod}</h2>
          <div class="comentario">${comentarios[i] && comentarios[i].trim() !== "" ? comentarios[i] : "-"}</div>
        </td>
        <td><h2>S/ ${(precios[i] || 0)}</h2></td>
      `;
      tablaBody.appendChild(row);
    }
  });
</script>

</body>
</html>
